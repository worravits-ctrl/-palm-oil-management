{% extends "base.html" %}
{% block content %}
<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß (‡∏£‡∏≤‡∏¢‡∏ï‡πâ‡∏ô)</h2>
<form method="post">
  {{ form.hidden_tag() }}
  <div class="row">
    {{ form.date.label }} {{ form.date(class="input", value=form.date.data.strftime('%Y-%m-%d') if form.date.data else '', id="date_input") }}
    <span id="thai_year" style="margin-left:10px;color:#6ed0ff;font-weight:bold;"></span>
  </div>
  <script>
    function updateThaiYear(){
      const dateVal = document.getElementById('date_input').value;
      if(dateVal){
        const y = parseInt(dateVal.split('-')[0]);
        document.getElementById('thai_year').innerText = '‡∏õ‡∏µ ‡∏û.‡∏®. ' + (y+543);
      }else{
        document.getElementById('thai_year').innerText = '';
      }
    }
    document.getElementById('date_input').addEventListener('input', updateThaiYear);
    updateThaiYear();
  </script>
  <div class="row">
    {{ form.palm_code.label }} 
    {{ form.palm_code(class="input", list="palm_codes", placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°", id="palm_code_input", autocomplete="off") }}
    <datalist id="palm_codes">
      {% for palm in palms %}
        <option value="{{ palm.code }}">{{ palm.code }}</option>
      {% endfor %}
    </datalist>
    <small style="color:#666;">üí° ‡∏°‡∏µ {{ palms|length }} ‡∏ï‡πâ‡∏ô: ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö A1-L26 | ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</small>
  </div>
  
  <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
  <div class="row" id="palm_status" style="display:none;">
    <div id="palm_found" style="color:#28a745; display:none;">
      ‚úÖ <span id="found_text"></span>
    </div>
    <div id="palm_not_found" style="color:#dc3545; display:none;">
      ‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ
    </div>
  </div>
  
  <script>
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°
    const palmInput = document.getElementById('palm_code_input');
    const palmOptions = Array.from(document.querySelectorAll('#palm_codes option')).map(opt => opt.value);
    
    palmInput.addEventListener('input', function() {
      const value = this.value.toUpperCase();
      this.value = value; // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà
      
      const statusDiv = document.getElementById('palm_status');
      const foundDiv = document.getElementById('palm_found');
      const notFoundDiv = document.getElementById('palm_not_found');
      const foundText = document.getElementById('found_text');
      
      if (value.length > 0) {
        statusDiv.style.display = 'block';
        
        if (palmOptions.includes(value)) {
          foundDiv.style.display = 'block';
          notFoundDiv.style.display = 'none';
          foundText.textContent = `‡∏û‡∏ö‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏° ${value}`;
        } else {
          foundDiv.style.display = 'none';
          notFoundDiv.style.display = 'block';
        }
      } else {
        statusDiv.style.display = 'none';
      }
    });
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    if (palmInput.value) {
      palmInput.dispatchEvent(new Event('input'));
    }
  </script>
  <div class="row">{{ form.bunch_count.label }} {{ form.bunch_count(class="input", placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏∞‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ") }}</div>
  <div class="row">{{ form.remarks.label }} {{ form.remarks(class="input", placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)") }}</div>
  {{ form.submit(class="btn") }}
</form>

<div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
  <h4>üìã ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h4>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <div>
      <h5>üå≥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°:</h5>
      <ul>
        <li><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ß‡∏°:</strong> {{ palms|length }} ‡∏ï‡πâ‡∏ô</li>
        <li><strong>‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏ô:</strong> A1 ‡∏ñ‡∏∂‡∏á L26</li>
        <li><strong>‡πÅ‡∏ñ‡∏ß:</strong> A, B, C, D, E, F, G, H, I, J, K, L</li>
        <li><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç:</strong> 1-26</li>
      </ul>
    </div>
    <div>
      <h5>üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ:</h5>
      <ul>
        <li>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÄ‡∏ä‡πà‡∏ô <code>A1</code></li>
        <li>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô <code>A</code></li>
        <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏ô input ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å dropdown</li>
        <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
      </ul>
    </div>
  </div>
  
  <div style="margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 4px;">
    <strong>üîç ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> A1, B15, C26, F10, J5, L26
  </div>
</div>
{% endblock %}
