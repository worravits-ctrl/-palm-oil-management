{% extends "base.html" %}
{% block content %}
<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå (Notes)</h2>
<div style="margin-bottom:15px;">
  <a class="btn" href="{{ url_for('notes_export') }}">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</a>
  <form action="{{ url_for('notes_import') }}" method="post" enctype="multipart/form-data" style="display:inline-block;margin-left:10px;">
    <label>üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV:</label>
    <input type="file" name="file" accept=".csv" required style="margin:0 5px;">
    <button class="btn" type="submit">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
    <small style="margin-left:5px;color:#666;">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: date,title,content</small>
  </form>
</div>
{% if form %}
<form method="post">
  {{ form.hidden_tag() }}
  <div class="row">
    {{ form.date.label }} {{ form.date(class="input", id="date_input") }}
    <span id="thai_year" style="margin-left:10px;color:#6ed0ff;font-weight:bold;"></span>
  </div>
  <script>
    function updateThaiYear(){
      const dateVal = document.getElementById('date_input').value;
      if(dateVal){
        const y = parseInt(dateVal.split('-')[0]);
        document.getElementById('thai_year').innerText = '‡∏õ‡∏µ ‡∏û.‡∏®. ' + (y+543);
      }else{
        document.getElementById('thai_year').innerText = '';
      }
    }
    document.getElementById('date_input').addEventListener('input', updateThaiYear);
    // Set default date to today and update Thai year display
    window.onload = function() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      if(!document.getElementById('date_input').value) {
        document.getElementById('date_input').value = yyyy + '-' + mm + '-' + dd;
      }
      updateThaiYear();
    };
  </script>
  <div class="row">{{ form.title.label }} {{ form.title(class="input") }}</div>
  <div class="row">{{ form.content.label }} {{ form.content(class="input") }}</div>
  {{ form.submit(class="btn") }}
</form>
{% endif %}
<table class="table" style="margin-top:1rem;">
  <thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
  <tbody>
    {% for r in rows %}
    <tr>
      <td>{{ (r.date.day|string).zfill(2) }}/{{ (r.date.month|string).zfill(2) }}/{{ r.date.year + 543 }}</td>
      <td>{{ r.title }}</td>
      <td>{{ r.content }}</td>
      <td>
        <a class="btn edit" href="{{ url_for('note_edit', id=r.id) }}" style="margin-right:5px;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
        <form method="post" action="{{ url_for('note_delete', id=r.id) }}" style="display:inline;" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡∏µ‡πâ?');">
          <button class="btn delete" type="submit">‡∏•‡∏ö</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
