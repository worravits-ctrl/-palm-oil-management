{% extends "base.html" %}
{% block content %}
<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß (‡∏£‡∏≤‡∏¢‡∏ï‡πâ‡∏ô) - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</h2>

<style>
.palm-grid {
    display: grid;
    grid-template-columns: repeat(26, 1fr);
    gap: 8px;
    margin: 20px 0;
    max-width: 100%;
    overflow-x: auto;
}

.palm-icon {
    width: 50px;
    height: 60px;
    border: 2px solid #28a745;
    border-radius: 8px;
    background: linear-gradient(45deg, #4CAF50, #81C784);
    color: white;
    font-size: 11px;
    font-weight: bold;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select: none;
}

.palm-icon:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    border-color: #FFC107;
    background: linear-gradient(45deg, #66BB6A, #A5D6A7);
}

.palm-icon.selected {
    background: linear-gradient(45deg, #FF9800, #FFB74D);
    border-color: #FF5722;
    transform: scale(1.15);
    box-shadow: 0 6px 12px rgba(255, 152, 0, 0.4);
}

.palm-icon::before {
    content: "üå¥";
    font-size: 20px;
    display: block;
    margin-bottom: 2px;
}

.row-header {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #6c757d;
    color: white;
    font-weight: bold;
    border-radius: 5px;
    margin: 5px 0;
    height: 40px;
}

.form-section {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    border-left: 4px solid #28a745;
}

.selected-info {
    background: #e8f5e8;
    border: 2px solid #28a745;
    border-radius: 8px;
    padding: 15px;
    margin: 15px 0;
    text-align: center;
    display: none;
}

.selected-info.show {
    display: block;
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 15px 0;
    font-size: 14px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
}

.legend-color {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 2px solid #ccc;
}

.normal { background: linear-gradient(45deg, #4CAF50, #81C784); }
.hover { background: linear-gradient(45deg, #66BB6A, #A5D6A7); }
.selected { background: linear-gradient(45deg, #FF9800, #FFB74D); }

@media (max-width: 768px) {
    .palm-grid {
        grid-template-columns: repeat(13, 1fr);
        gap: 4px;
    }
    
    .palm-icon {
        width: 40px;
        height: 50px;
        font-size: 10px;
    }
    
    .palm-icon::before {
        font-size: 16px;
    }
}
</style>

<form method="post" id="harvest_form">
    {{ form.hidden_tag() }}
    
    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
    <div class="form-section">
        <h3>üìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</h3>
        <div class="row">
            {{ form.date.label }} 
            {{ form.date(class="input", value=form.date.data.strftime('%Y-%m-%d') if form.date.data else '', id="date_input") }}
            <span id="thai_year" style="margin-left:10px;color:#6ed0ff;font-weight:bold;"></span>
        </div>
    </div>

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏° -->
    <div class="form-section">
        <h3>üå¥ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏° (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô)</h3>
        
        <!-- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color normal"></div>
                <span>‡∏õ‡∏Å‡∏ï‡∏¥</span>
            </div>
            <div class="legend-item">
                <div class="legend-color hover"></div>
                <span>Hover</span>
            </div>
            <div class="legend-item">
                <div class="legend-color selected"></div>
                <span>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span>
            </div>
        </div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
        <div id="selected_info" class="selected-info">
            <h4>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: <span id="selected_palm"></span></h4>
            <p>‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°‡πÅ‡∏ñ‡∏ß <span id="selected_row"></span> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç <span id="selected_number"></span></p>
        </div>

        <!-- Hidden input ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ -->
        {{ form.palm_code(type="hidden", id="palm_code_hidden") }}

        <!-- Grid ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏° -->
        {% set rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'] %}
        {% for row in rows %}
        <div class="row-header">‡πÅ‡∏ñ‡∏ß {{ row }}</div>
        <div class="palm-grid">
            {% for num in range(1, 27) %}
            {% set palm_code = row ~ num %}
            <div class="palm-icon" data-palm="{{ palm_code }}" title="‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏° {{ palm_code }}">
                {{ palm_code }}
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß -->
    <div class="form-section">
        <h3>üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</h3>
        <div class="row">
            {{ form.bunch_count.label }} 
            {{ form.bunch_count(class="input", placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏∞‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ") }}
        </div>
        <div class="row">
            {{ form.remarks.label }} 
            {{ form.remarks(class="input", placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)") }}
        </div>
    </div>

    {{ form.submit(class="btn", id="submit_btn", disabled=true) }}
</form>

<script>
// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏µ ‡∏û.‡∏®.
function updateThaiYear(){
    const dateVal = document.getElementById('date_input').value;
    if(dateVal){
        const y = parseInt(dateVal.split('-')[0]);
        document.getElementById('thai_year').innerText = '‡∏õ‡∏µ ‡∏û.‡∏®. ' + (y+543);
    }else{
        document.getElementById('thai_year').innerText = '';
    }
}
document.getElementById('date_input').addEventListener('input', updateThaiYear);
updateThaiYear();

// ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°
let selectedPalm = null;

document.querySelectorAll('.palm-icon').forEach(icon => {
    icon.addEventListener('click', function() {
        const palmCode = this.dataset.palm;
        
        // ‡∏•‡∏ö selection ‡πÄ‡∏Å‡πà‡∏≤
        document.querySelectorAll('.palm-icon.selected').forEach(el => {
            el.classList.remove('selected');
        });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° selection ‡πÉ‡∏´‡∏°‡πà
        this.classList.add('selected');
        selectedPalm = palmCode;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï hidden input
        document.getElementById('palm_code_hidden').value = palmCode;
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        const selectedInfo = document.getElementById('selected_info');
        const selectedPalmSpan = document.getElementById('selected_palm');
        const selectedRowSpan = document.getElementById('selected_row');
        const selectedNumberSpan = document.getElementById('selected_number');
        
        selectedPalmSpan.textContent = palmCode;
        selectedRowSpan.textContent = palmCode.charAt(0);
        selectedNumberSpan.textContent = palmCode.slice(1);
        
        selectedInfo.classList.add('show');
        
        // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô submit button
        document.getElementById('submit_btn').disabled = false;
        
        // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.querySelector('.form-section:last-of-type').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
    });
});

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
const initialPalmCode = document.getElementById('palm_code_hidden').value;
if (initialPalmCode) {
    const initialIcon = document.querySelector(`[data-palm="${initialPalmCode}"]`);
    if (initialIcon) {
        initialIcon.click();
    }
}

// ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ submit ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°
document.getElementById('harvest_form').addEventListener('submit', function(e) {
    if (!selectedPalm) {
        e.preventDefault();
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
        return false;
    }
});
</script>

<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
    <h4>üìã ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</h4>
    <ul>
        <li><strong>üéØ ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</li>
        <li><strong>üå¥ ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô:</strong> ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 312 ‡∏ï‡πâ‡∏ô ‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß A-L ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç 1-26</li>
        <li><strong>üì± Mobile:</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠</li>
        <li><strong>‚úÖ ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô:</strong> ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏õ‡∏≤‡∏•‡πå‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ</li>
    </ul>
</div>

{% endblock %}
